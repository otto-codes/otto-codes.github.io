<style>
    /* basic reset */
    * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
    }

    body {
        font-family: 'Montserrat', Arial, Verdana;
        color: #333;
    }

    ul {
        margin: 0;
    }

    #msform {
        max-width: 80vw;
        margin: 0vw auto;
        text-align: center;
        box-shadow: 0 0 0.5vw 0.5vw rgba(0, 0, 0, 0.1);
        border-radius: 1vw;
    }

    #device-selector-container {
        width: 100%;
        text-align: center;
        /* box-shadow: 0 0 1vw 0.5vw rgba(0, 0, 0, 0.1); */
        margin-top: 3vw;
    }

    #msform fieldset {
        background: #f5f5f5;
        border: none;
        padding: 0vw;
        margin: 0px;
        /* box-shadow: 0 0 1vw 0.5vw rgba(0, 0, 0, 0.1); */
    }

    #msform input,
    #msform textarea {
        padding: 1.5vw;
        border-radius: 2px;
        margin-bottom: 0vw;
        width: 80%;
        background: #eaeaea;
        color: #333;
        font-size: 4vw;
        border: 0.5vw solid #bbb;
        text-align: center;
    }

    #device-form-container {
        background: #f5f5f5;
        border: none;
        padding: none;
    }

    #msform label {
        font-size: 4vw;
        padding-top: 4vw;
        text-transform: uppercase;
        color: #333;
    }

    select#device-selector {
        font-size: 5vw;
        text-align: center;
        text-transform: uppercase;
        border-top-left-radius: 1vw;
        border-top-right-radius: 1vw;
        background: #27AE60;
        border: 0vw solid #333;
        color: #ffffff;
        margin-bottom: 0vw;
        width: 100%;
        padding: 3vw;
    }

    #msform button {
        background: #27AE60;
        color: white;
        border: none;
        border-radius: 2vw;
        cursor: pointer;
        padding: 5vw;
        margin-bottom: 15vw;
        margin-top: 6vw;
        font-size: 4vw;
    }

    .fs-title {
        font-size: 6vw;
        text-transform: uppercase;
        color: #27AE60;
        padding: 2vw;
    }

    .fs-subtitle {
        font-weight: normal;
        font-size: 3.5vw;
        color: #666;
        text-align: center;
        padding: 4vw;
    }

    #progressbar {
        /* box-shadow: 0 0 2vw 1vw rgba(0, 0, 0, 0.1); */
        margin-top: 0vw;
        overflow: hidden;
        counter-reset: step;
        list-style-type: none;
        display: flex;
        justify-content: space-between;
        align-items: center;
        border-bottom-left-radius: 5px;
        border-bottom-right-radius: 5px;
    }

    #progressbar li {
        color: #333;
        text-transform: uppercase;
        font-size: 2.5vw;
        width: 100%;
        position: relative;
        background: #eaeaea;
        padding: 2px;
    }

    #progressbar li:before {
        content: var(--date);
        height: 6vw;
        line-height: 6vw;
        display: block;
        font-size: 5vw;
        color: #333;
        background: #eaeaea;
        border-radius: 5px;
        margin: 0 auto 0vw auto;
    }

    #progressbar li.active:before,
    #progressbar li.active {
        background: #27AE60;
        color: white;
    }

    /* Animations, slides and transitions remain the same as they do not need a color change */

    .data-container table {
        width: 100%;
        border-collapse: collapse;
        margin-top: 0vw;
        text-align: center;
        table-layout: fixed;
    }

    .data-container th,
    .data-container td {
        padding: 0.7vw;
        border-bottom: 0.2vw solid #bbb;
        text-align: center;
    }

    .data-container th {
        background-color: #d4d4d4;
        color: #333;
        font-size: 3.5vw;
        text-transform: uppercase;
    }

    .data-container td {
        background-color: #eaeaea;
        font-size: 3vw;
        color: #333;
    }

    .data-container .power-on {
        color: #27AE60;
    }

    .data-container .power-off {
        color: #666;
    }

    .credits-footer {
        display: flex;
        justify-content: space-between;
        padding-top: 2vw;
        align-items: center;
        background-color: #f5f5f5;
    }

    .credits-text-left,
    .credits-text-right {
        margin: 0;
        color: #333;
    }

    .device-data-card {
        background-color: #f9f9f9;
        border-radius: 10px;
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
        padding: 30px;
        /* increased padding */
        margin: 20px auto;
        max-width: 100%;
        /* increased width */
        transition: transform 0.3s ease-in-out;
        /* smooth transition for hover effect */
    }

    .device-data-card:hover {
        transform: scale(1.05);
        /* subtle zoom effect on hover */
    }

    .device-data-card>div {
        margin-bottom: 20px;
        /* increased spacing */
        padding: 10px;
        /* added padding for each section */
        background: #ffffff;
        /* different background for each section */
        border-radius: 5px;
        /* rounded corners for sections */
    }

    .device-data-card>div:last-child {
        margin-bottom: 0;
    }

    .device-data-card span {
        font-weight: 600;
        /* bolder font for emphasis */
        font-size: 1.1em;
        /* larger font size */
        display: inline-block;
        /* block level allows for more control */
        margin-left: 5px;
        /* spacing between label and value */
    }

    .device-info {
        font-size: 1.4em;
        /* increased size for device info */
        color: #333;
        font-weight: 700;
        /* make it bolder */
        margin-bottom: 25px;
        /* extra spacing */
    }

    .last-price-fetch,
    .daily-average-price,
    .your-average-price,
    .your-savings {
        color: #333;
        /* darker font color for better readability */
        font-size: 1.2em;
        /* larger font size */
        background: #f0f0f0;
        /* light grey background for sections */
    }

    .your-savings span {
        color: #4CAF50;
        /* keep the savings in green for visual emphasis */
        font-size: 1.3em;
        /* slightly larger font for savings value */
    }


    /* ... [your existing CSS above this comment] ... */

    /* Media Query for Desktop and Large Screens */
    @media (min-width: 1024px) {
        #msform {
            max-width: 60vw;
            margin: 2vw auto;
        }

        #msform input,
        #msform textarea {
            font-size: 1.5vw;
            padding: 0.5vw;
            border: 0.2vw solid #bbb;
            border-radius: 0.3vw;
        }

        #msform label {
            font-size: 1.5vw;
            padding-top: 1vw;
        }

        select#device-selector {
            font-size: 2vw;
            padding: 1vw;
        }

        #msform button {
            font-size: 1.5vw;
            padding: 2vw;
            margin-bottom: 5vw;
            margin-top: 2vw;
        }

        .fs-title {
            font-size: 3vw;
        }

        .fs-subtitle {
            font-size: 1.5vw;
            padding: 2vw;
        }

        #progressbar li {
            font-size: 1vw;
        }

        #progressbar li:before {
            font-size: 2vw;
            height: 3vw;
            line-height: 3vw;
        }

        .data-container th,
        .data-container td {
            padding: 0.3vw;
        }

        .data-container th {
            font-size: 1.5vw;
        }

        .data-container td {
            font-size: 1.3vw;
        }
    }
</style>

<!-- multistep form -->
<div id="msform">
    <!-- Add this right above your <form> -->
    <div id="device-selector-container">
        <select id="device-selector">
            <option id="device-selection-text" value="default">Select Device</option>
            <option id="add-device-text" value="add-device">Add Device</option>
        </select>
    </div>
    <h3 id="title" class="fs-subtitle">No device is selected. Select one from below. </h3>
    <!-- fieldsets -->
    <div id="fieldsets">
        <fieldset>
            <div class="data-container">
                <div id="yesterday-data"></div>
            </div>
        </fieldset>
        <fieldset class="current">
            <div class="data-container">
                <div id="today-data"></div>
            </div>
        </fieldset>
        <fieldset>
            <div class="data-container">
                <div id="tomorrow-data"></div>
            </div>
        </fieldset>
    </div>

    <div id="device-form-container" style="text-align: center; display: none;">
        <label for="device-name" id="device-name-label" style="display: block;">NAME YOUR DEVICE: </label>
        <input id="device-name" type="text" placeholder="Water Boiler">
        <label for="device-code" id="device-code-label" style="display: block;">Device Code: </label>
        <input id="device-code" type="text" placeholder="1234-ABCD-5678"
            pattern="^[0-9a-zA-Z]{4}-[0-9a-zA-Z]{4}-[0-9a-zA-Z]{4}-[0-9a-zA-Z]{4}$" maxlength="14">
        <br>
        <button id="cancel-device">Cancel</button>
        <button id="submit-device">Add Device</button>
    </div>
    <!-- progressbar -->
    <ul id="progressbar">
        <li id="yesterday-menu">Yesterday</li>
        <li class="active" id="today-menu">Today</li>
        <li id="tomorrow-menu">Tomorrow</li>
    </ul>
</div>
<script>

    // Function to update active class on progress bar items
    function updateActiveProgress(activeMenuId) {
        document.querySelectorAll("#progressbar li").forEach(function (menuItem) {
            menuItem.classList.remove("active");
        });
        document.getElementById(activeMenuId).classList.add("active");
    }

    document.addEventListener("DOMContentLoaded", function () {
        // Function to hide all fieldsets and then show the selected one


        // Event listener for the "Yesterday" menu item
        document.getElementById("yesterday-menu").addEventListener("click", function () {

            updateActiveProgress("yesterday-menu");
            document.getElementById('yesterday-data').style.display = 'block';
            document.getElementById('today-data').style.display = 'none';
            document.getElementById('tomorrow-data').style.display = 'none';
        });

        // Event listener for the "Today" menu item
        document.getElementById("today-menu").addEventListener("click", function () {

            updateActiveProgress("today-menu");
            document.getElementById('yesterday-data').style.display = 'none';
            document.getElementById('today-data').style.display = 'block';
            document.getElementById('tomorrow-data').style.display = 'none';

        });

        // Event listener for the "Tomorrow" menu item
        document.getElementById("tomorrow-menu").addEventListener("click", function () {

            updateActiveProgress("tomorrow-menu");
            document.getElementById('yesterday-data').style.display = 'none';
            document.getElementById('today-data').style.display = 'none';
            document.getElementById('tomorrow-data').style.display = 'block';
        });
        document.getElementById('yesterday-data').style.display = 'none';
        document.getElementById('today-data').style.display = 'block';
        document.getElementById('tomorrow-data').style.display = 'none';
    });

    document.addEventListener('DOMContentLoaded', () => {
        const listItems = document.querySelectorAll('#progressbar li');
        const dateOffsets = [-1, 0, 1];  // Yesterday, today, and tomorrow

        listItems.forEach((li, index) => {
            if (index < dateOffsets.length) {
                const date = new Date();
                date.setDate(date.getDate() + dateOffsets[index]);
                const day = String(date.getDate());
                const month = String(date.getMonth() + 1);
                const formattedDate = `"${day}.${month}"`;  // Quote the string for valid CSS content
                li.style.setProperty('--date', formattedDate);
            }
        });
    });
    const translations = {
        english: {
            "title": "No device is selected. Select or add a device from above.",
            "yesterday-menu": "Yesterday",
            "today-menu": "Today",
            "tomorrow-menu": "Tomorrow",
            "device-selection-text": "Select device",
            "add-device-text": "Add device",
            "device-name-label": "Name your device",
            "device-name-prefilled": "Kitchen radiator",
            "device-code-label": "Device code:",
            "cancel-device": "Cancel",
            "submit-device": "Save",
            "time": "Time",
            "price": "Price",
            "power": "Power",
            "on": "On",
            "off": "Off",
            "today-at": "today at ",
            "today": "today.",
            "yesterday-at": "yesterday at ",
            "yesterday": "yesterday.",
            "last-price-fetch": "Last price fetch ",
            "days-ago": "-days ago",
            "days-ago-at": "-days ago at ",
            "daily-average-price": "Daily average price",
            "your-average-price": "Your average price",
            "your-savings": "Your savings",
            "device-info": "Device info",
            "come-back-later": "Prices are annouced today at 13:00 CET."
        },
        finnish: {
            "title": "Ei laitetta valittuna. Valitse tai lisää laite yläpuolella olevasta valikosta.",
            "yesterday-menu": "Eilen",
            "today-menu": "Tänään",
            "tomorrow-menu": "Huomenna",
            "device-selection-text": "Valitse laite",
            "add-device-text": "Lisää laite",
            "device-name-label": "Nimeä laitteesi",
            "device-name-prefilled": "Keittiön lämpöpatteri",
            "device-code-label": "Laitekoodi:",
            "cancel-device": "Peruuta",
            "submit-device": "Tallenna",
            "time": "Aika",
            "price": "Hinta",
            "power": "Virta",
            "on": "Päällä",
            "off": "Pois",
            "today": "Tänään",
            "today-at": "Tänään klo ",
            "yesterday-at": "Eilen klo. ",
            "yesterday": "Eilen.",
            "last-price-fetch": "Viimeisin hinta haettu ",
            "days-ago": "-päivää sitten",
            "days-ago-at": "-päivää sitten klo. ",
            "daily-average-price": "Päivän keskihinta",
            "your-average-price": "Sinun keskihintasi",
            "your-savings": "Säästösi",
            "device-info": "Laitteen tiedot",
            "come-back-later": "Hinnat julkaistaan tänään klo. 14:00 Nordpool sähköpörssin sulkeuduttua."
        },
        swedish: {
            "title": "Ingen enhet är vald. Välj eller lägg till en enhet ovan.",
            "yesterday-menu": "Igår",
            "today-menu": "Idag",
            "tomorrow-menu": "Imorgon",
            "device-selection-text": "Välj enhet",
            "add-device-text": "Lägg till enhet",
            "device-name-label": "Namnge din enhet",
            "device-name-prefilled": "Köksradiator",
            "device-code-label": "Enhetskod:",
            "cancel-device": "Avbryt",
            "submit-device": "Spara",
            "time": "Tid",
            "price": "Pris",
            "power": "Kraft",
            "on": "På",
            "off": "Av",
            "today-at": "idag kl ",
            "today": "idag.",
            "yesterday-at": "igår kl ",
            "yesterday": "igår.",
            "last-price-fetch": "Senaste prisuppdatering ",
            "days-ago": "-dagar sedan",
            "days-ago-at": "-dagar sedan kl ",
            "daily-average-price": "Genomsnittligt dagspris",
            "your-average-price": "Ditt genomsnittspris",
            "your-savings": "Dina besparingar",
            "device-info": "Enhetsinformation",
            "come-back-later": "Priser meddelas idag kl 13:00 CET."
        },
        norwegian: {
            "title": "Ingen enhet er valgt. Velg eller legg til en enhet ovenfor.",
            "yesterday-menu": "I går",
            "today-menu": "I dag",
            "tomorrow-menu": "I morgen",
            "device-selection-text": "Velg enhet",
            "add-device-text": "Legg til enhet",
            "device-name-label": "Navngi enheten din",
            "device-name-prefilled": "Kjøkkenradiator",
            "device-code-label": "Enhetskode:",
            "cancel-device": "Avbryt",
            "submit-device": "Lagre",
            "time": "Tid",
            "price": "Pris",
            "power": "Kraft",
            "on": "På",
            "off": "Av",
            "today-at": "i dag kl ",
            "today": "i dag.",
            "yesterday-at": "i går kl ",
            "yesterday": "i går.",
            "last-price-fetch": "Siste prisopphenting ",
            "days-ago": "-dager siden",
            "days-ago-at": "-dager siden kl ",
            "daily-average-price": "Daglig gjennomsnittspris",
            "your-average-price": "Din gjennomsnittspris",
            "your-savings": "Dine besparelser",
            "device-info": "Enhetsinformasjon",
            "come-back-later": "Priser annonseres i dag kl. 13:00 CET."
        },
        danish: {
            "title": "Ingen enhed er valgt. Vælg eller tilføj en enhed ovenfor.",
            "yesterday-menu": "I går",
            "today-menu": "I dag",
            "tomorrow-menu": "I morgen",
            "device-selection-text": "Vælg enhed",
            "add-device-text": "Tilføj enhet",
            "device-name-label": "Navngiv din enhed",
            "device-name-prefilled": "Køkkenradiator",
            "device-code-label": "Enheds kode:",
            "cancel-device": "Annuller",
            "submit-device": "Gem",
            "time": "Tid",
            "price": "Pris",
            "power": "Kraft",
            "on": "Tændt",
            "off": "Slukket",
            "today-at": "i dag kl. ",
            "today": "i dag.",
            "yesterday-at": "i går kl. ",
            "yesterday": "i går.",
            "last-price-fetch": "Sidste prisopdatering ",
            "days-ago": "-dage siden",
            "days-ago-at": "-dage siden kl. ",
            "daily-average-price": "Dagligt gennemsnitspris",
            "your-average-price": "Din gennemsnittspris",
            "your-savings": "Dine besparelser",
            "device-info": "Enhedsinfo",
            "come-back-later": "Priserne annonceres i dag kl. 13:00 CET."
        },
        estonian: {
            "title": "Seadet pole valitud. Valige või lisage seade ülalt.",
            "yesterday-menu": "Eile",
            "today-menu": "Täna",
            "tomorrow-menu": "Homme",
            "device-selection-text": "Vali seade",
            "add-device-text": "Lisa seade",
            "device-name-label": "Nimeta oma seade",
            "device-name-prefilled": "Köögi radiaator",
            "device-code-label": "Seadme kood:",
            "cancel-device": "Tühista",
            "submit-device": "Salvesta",
            "time": "Aeg",
            "price": "Hind",
            "power": "Võimsus",
            "on": "Sees",
            "off": "Väljas",
            "today-at": "täna kell ",
            "today": "täna.",
            "yesterday-at": "eile kell ",
            "yesterday": "eile.",
            "last-price-fetch": "Viimane hinnapäring ",
            "days-ago": "-päeva tagasi",
            "days-ago-at": "-päeva tagasi kell ",
            "daily-average-price": "Päevane keskmine hind",
            "your-average-price": "Sinu keskmine hind",
            "your-savings": "Sinu säästud",
            "device-info": "Seadme info",
            "come-back-later": "Hinnad teatatakse täna kell 13:00 CET."
        },
        latvian: {
            "title": "Nav izvēlēta neviena ierīce. Atlasiet vai pievienojiet ierīci augšpusē.",
            "yesterday-menu": "Vakar",
            "today-menu": "Šodien",
            "tomorrow-menu": "Rīt",
            "device-selection-text": "Izvēlēties ierīci",
            "add-device-text": "Pievienot ierīci",
            "device-name-label": "Nosaukiet savu ierīci",
            "device-name-prefilled": "Virtuves radiators",
            "device-code-label": "Ierīces kods:",
            "cancel-device": "Atcelt",
            "submit-device": "Saglabāt",
            "time": "Laiks",
            "price": "Cena",
            "power": "Jauda",
            "on": "Ieslēgts",
            "off": "Izslēgts",
            "today-at": "šodien plkst. ",
            "today": "šodien.",
            "yesterday-at": "vakar plkst. ",
            "yesterday": "vakar.",
            "last-price-fetch": "Pēdējā cenas pieprasījuma ",
            "days-ago": "-dienas atpakaļ",
            "days-ago-at": "-dienas atpakaļ plkst. ",
            "daily-average-price": "Vidējā dienas cena",
            "your-average-price": "Jūsu vidējā cena",
            "your-savings": "Jūsu ietaupījumi",
            "device-info": "Ierīces informācija",
            "come-back-later": "Cenas tiks paziņotas šodien plkst. 13:00 CET."
        },
        lithuanian: {
            "title": "Nepasirinktas joks įrenginys. Pasirinkite arba pridėkite įrenginį aukščiau.",
            "yesterday-menu": "Vakar",
            "today-menu": "Šiandien",
            "tomorrow-menu": "Rytoj",
            "device-selection-text": "Pasirinkti įrenginį",
            "add-device-text": "Pridėti įrenginį",
            "device-name-label": "Pavadinkite savo įrenginį",
            "device-name-prefilled": "Virtuvės radiatorius",
            "device-code-label": "Įrenginio kodas:",
            "cancel-device": "Atšaukti",
            "submit-device": "Išsaugoti",
            "time": "Laikas",
            "price": "Kaina",
            "power": "Galia",
            "on": "Įjungta",
            "off": "Išjungta",
            "today-at": "šiandien ",
            "today": "šiandien.",
            "yesterday-at": "vakar ",
            "yesterday": "vakar.",
            "last-price-fetch": "Paskutinis kainos paieška ",
            "days-ago": "-dienų prieš",
            "days-ago-at": "-dienų prieš ",
            "daily-average-price": "Vidutinė dienos kaina",
            "your-average-price": "Jūsų vidutinė kaina",
            "your-savings": "Jūsų sutaupymai",
            "device-info": "Įrenginio informacija",
            "come-back-later": "Kainos paskelbiamos šiandien 13:00 CET."
        },
        spanish: {
            "title": "No se ha seleccionado ningún dispositivo. Selecciona o añade un dispositivo arriba.",
            "yesterday-menu": "Ayer",
            "today-menu": "Hoy",
            "tomorrow-menu": "Mañana",
            "device-selection-text": "Seleccionar dispositivo",
            "add-device-text": "Añadir dispositivo",
            "device-name-label": "Nombre de tu dispositivo",
            "device-name-prefilled": "Radiador de cocina",
            "device-code-label": "Código del dispositivo:",
            "cancel-device": "Cancelar",
            "submit-device": "Guardar",
            "time": "Hora",
            "price": "Precio",
            "power": "Potencia",
            "on": "Encendido",
            "off": "Apagado",
            "today-at": "hoy a las ",
            "today": "hoy.",
            "yesterday-at": "ayer a las ",
            "yesterday": "ayer.",
            "last-price-fetch": "Última búsqueda de precio ",
            "days-ago": "-días atrás",
            "days-ago-at": "-días atrás a las ",
            "daily-average-price": "Precio medio diario",
            "your-average-price": "Tu precio medio",
            "your-savings": "Tus ahorros",
            "device-info": "Información del dispositivo",
            "come-back-later": "Los precios se anunciarán hoy a las 13:00 CET."
        },
        dutch: {
            "title": "Er is geen apparaat geselecteerd. Selecteer of voeg hierboven een apparaat toe.",
            "yesterday-menu": "Gisteren",
            "today-menu": "Vandaag",
            "tomorrow-menu": "Morgen",
            "device-selection-text": "Selecteer apparaat",
            "add-device-text": "Apparaat toevoegen",
            "device-name-label": "Geef je apparaat een naam",
            "device-name-prefilled": "Keukenradiator",
            "device-code-label": "Apparaatcode:",
            "cancel-device": "Annuleren",
            "submit-device": "Opslaan",
            "time": "Tijd",
            "price": "Prijs",
            "power": "Vermogen",
            "on": "Aan",
            "off": "Uit",
            "today-at": "vandaag om ",
            "today": "vandaag.",
            "yesterday-at": "gisteren om ",
            "yesterday": "gisteren.",
            "last-price-fetch": "Laatste prijsopvraging ",
            "days-ago": "-dagen geleden",
            "days-ago-at": "-dagen geleden om ",
            "daily-average-price": "Dagelijkse gemiddelde prijs",
            "your-average-price": "Jouw gemiddelde prijs",
            "your-savings": "Jouw besparingen",
            "device-info": "Apparaatinformatie",
            "come-back-later": "Prijzen worden vandaag om 13:00 CET aangekondigd."
        },
        german: {
            "title": "Es ist kein Gerät ausgewählt. Wählen oder fügen Sie oben ein Gerät hinzu.",
            "yesterday-menu": "Gestern",
            "today-menu": "Heute",
            "tomorrow-menu": "Morgen",
            "device-selection-text": "Gerät auswählen",
            "add-device-text": "Gerät hinzufügen",
            "device-name-label": "Benennen Sie Ihr Gerät",
            "device-name-prefilled": "Küchenheizkörper",
            "device-code-label": "Gerätecode:",
            "cancel-device": "Abbrechen",
            "submit-device": "Speichern",
            "time": "Zeit",
            "price": "Preis",
            "power": "Leistung",
            "on": "Ein",
            "off": "Aus",
            "today-at": "heute um ",
            "today": "heute.",
            "yesterday-at": "gestern um ",
            "yesterday": "gestern.",
            "last-price-fetch": "Letzte Preisabfrage ",
            "days-ago": "-Tage her",
            "days-ago-at": "-Tage her um ",
            "daily-average-price": "Täglicher Durchschnittspreis",
            "your-average-price": "Ihr Durchschnittspreis",
            "your-savings": "Ihre Einsparungen",
            "device-info": "Geräteinformation",
            "come-back-later": "Preise werden heute um 13:00 CET bekannt gegeben."
        },
        french: {
            "title": "Aucun appareil sélectionné. Sélectionnez ou ajoutez un appareil ci-dessus.",
            "yesterday-menu": "Hier",
            "today-menu": "Aujourd'hui",
            "tomorrow-menu": "Demain",
            "device-selection-text": "Sélectionner l'appareil",
            "add-device-text": "Ajouter un appareil",
            "device-name-label": "Nommez votre appareil",
            "device-name-prefilled": "Radiateur de cuisine",
            "device-code-label": "Code de l'appareil :",
            "cancel-device": "Annuler",
            "submit-device": "Enregistrer",
            "time": "Heure",
            "price": "Prix",
            "power": "Puissance",
            "on": "Allumé",
            "off": "Éteint",
            "today-at": "aujourd'hui à ",
            "today": "aujourd'hui.",
            "yesterday-at": "hier à ",
            "yesterday": "hier.",
            "last-price-fetch": "Dernière recherche de prix ",
            "days-ago": "il y a -jours",
            "days-ago-at": "il y a -jours à ",
            "daily-average-price": "Prix moyen quotidien",
            "your-average-price": "Votre prix moyen",
            "your-savings": "Vos économies",
            "device-info": "Infos sur l'appareil",
            "come-back-later": "Les prix sont annoncés aujourd'hui à 13:00 CET."
        },
        italian: {
            "title": "Nessun dispositivo selezionato. Seleziona o aggiungi un dispositivo qui sopra.",
            "yesterday-menu": "Ieri",
            "today-menu": "Oggi",
            "tomorrow-menu": "Domani",
            "device-selection-text": "Seleziona dispositivo",
            "add-device-text": "Aggiungi dispositivo",
            "device-name-label": "Nomina il tuo dispositivo",
            "device-name-prefilled": "Radiatore della cucina",
            "device-code-label": "Codice dispositivo:",
            "cancel-device": "Annulla",
            "submit-device": "Salva",
            "time": "Ora",
            "price": "Prezzo",
            "power": "Potenza",
            "on": "Acceso",
            "off": "Spento",
            "today-at": "oggi alle ",
            "today": "oggi.",
            "yesterday-at": "ieri alle ",
            "yesterday": "ieri.",
            "last-price-fetch": "Ultima ricerca prezzo ",
            "days-ago": "-giorni fa",
            "days-ago-at": "-giorni fa alle ",
            "daily-average-price": "Prezzo medio giornaliero",
            "your-average-price": "Il tuo prezzo medio",
            "your-savings": "I tuoi risparmi",
            "device-info": "Informazioni sul dispositivo",
            "come-back-later": "I prezzi verranno annunciati oggi alle 13:00 CET."
        },
        portuguese: {
            "title": "Nenhum dispositivo selecionado. Selecione ou adicione um dispositivo acima.",
            "yesterday-menu": "Ontem",
            "today-menu": "Hoje",
            "tomorrow-menu": "Amanhã",
            "device-selection-text": "Selecionar dispositivo",
            "add-device-text": "Adicionar dispositivo",
            "device-name-label": "Nomeie seu dispositivo",
            "device-name-prefilled": "Radiador da cozinha",
            "device-code-label": "Código do dispositivo:",
            "cancel-device": "Cancelar",
            "submit-device": "Salvar",
            "time": "Hora",
            "price": "Preço",
            "power": "Potência",
            "on": "Ligado",
            "off": "Desligado",
            "today-at": "hoje às ",
            "today": "hoje.",
            "yesterday-at": "ontem às ",
            "yesterday": "ontem.",
            "last-price-fetch": "Última busca de preço ",
            "days-ago": "-dias atrás",
            "days-ago-at": "-dias atrás às ",
            "daily-average-price": "Preço médio diário",
            "your-average-price": "Seu preço médio",
            "your-savings": "Suas economias",
            "device-info": "Informações do dispositivo",
            "come-back-later": "Os preços serão anunciados hoje às 13:00 CET."
        }


        // add translations
    };

    //Change the device code input to xxxx-xxxx-xxxx-xxxx
    document.getElementById('device-code').addEventListener('input', function (e) {
        var target = e.target,
            value = target.value.replace(/[^a-zA-Z0-9]/g, ''), // Remove non-alphanumeric characters
            dashAddedValue = '';

        // Loop through the cleaned value and add dashes
        for (let i = 0; i < value.length; i++) {
            if (i > 0 && i % 4 === 0) dashAddedValue += '-';
            dashAddedValue += value[i];
        }

        // Update the input's value
        target.value = dashAddedValue;

        // Position the cursor correctly after dashes
        if (e.inputType !== "deleteContentBackward" && (dashAddedValue.length === 5 || dashAddedValue.length === 10 || dashAddedValue.length === 15)) {
            target.setSelectionRange(dashAddedValue.length, dashAddedValue.length);
        }
    });

    function getBrowserLanguage() {
        const browserLanguage = navigator.language || navigator.userLanguage;
        const languageMap = {
            'en': 'english',
            'fi': 'finnish',
            'fr': 'french',
            'de': 'german',
            'it': 'italian',
            'es': 'spanish',
            'pt': 'portuguese',
            'nl': 'dutch',
            'sv': 'swedish',
            'da': 'danish',
            'no': 'norwegian',
            'hr': 'croatian',
            'lt': 'lithuanian',
            'lv': 'latvian',
            'et': 'estonian',
        };
        const prefix = browserLanguage.slice(0, 2); // get the first two characters of the language code
        return languageMap[prefix] || 'english'; // Default to English if language isn't in the map
    }

    function updateFormLanguage() {
        const selectedLanguage = getBrowserLanguage();
        const translation = translations[selectedLanguage];

        // Update the languge of the website
        document.getElementById("yesterday-menu").textContent = translation["yesterday-menu"];
        document.getElementById("today-menu").textContent = translation["today-menu"];
        document.getElementById("tomorrow-menu").textContent = translation["tomorrow-menu"];

        document.getElementById("title").textContent = translation["title"];

        document.getElementById("device-selection-text").textContent = translation["device-selection-text"];
        document.getElementById("add-device-text").textContent = translation["add-device-text"];
        document.getElementById("device-name-label").textContent = translation["device-name-label"];
        document.getElementById("device-code-label").textContent = translation["device-code-label"];
        document.getElementById("cancel-device").textContent = translation["cancel-device"];
        document.getElementById("submit-device").textContent = translation["submit-device"];
        document.getElementById('device-name').placeholder = translation["device-name-prefilled"];


    }

    // Call the updateFormLanguage() function to initially set the language
    updateFormLanguage();

    document.addEventListener("DOMContentLoaded", function () {
        const deviceSelector = document.getElementById("device-selector");

        // Initialize dropdown from local storage
        const savedDevices = JSON.parse(localStorage.getItem("devices") || "[]");
        savedDevices.forEach(device => {
            const option = new Option(device.name, device.code);
            deviceSelector.add(option);
        });


        // Add device to local storage after the 'submit-device' click event
        document.getElementById('submit-device').addEventListener('click', function () {
            const deviceName = document.getElementById('device-name').value.trim();
            const deviceCode = document.getElementById('device-code').value.trim();
            handleDeviceSubmission(deviceName, deviceCode);
        });

        // 
        async function handleDeviceSubmission(deviceName, deviceCode) {
            if (!deviceCode) {
                console.error("Device code is required for submission.");
                return;
            }

            try {
                const response = await fetch(`https://api.powerant.net/retrieve_data?api_key=${deviceCode}`);

                if (!response.ok) {
                    throw new Error("Invalid response from server");
                }

                const data = await response.json();

                const devices = JSON.parse(localStorage.getItem("devices") || "[]");
                const existingDevice = devices.find(device => device.code === deviceCode);

                if (existingDevice) {
                    if (deviceName)
                        existingDevice.name = deviceName;
                    existingDevice.country = data.country;
                    existingDevice.timestamp = data.timestamp;
                    existingDevice.hoursactive = data.hoursactive;
                    existingDevice.kwhtrigger = data.kwhtrigger;
                    existingDevice.selected = true;
                } else {
                    const newDevice = {
                        name: deviceName || "Unnamed Device",
                        code: deviceCode,
                        country: data.country,
                        timestamp: data.timestamp,
                        hoursactive: data.hoursactive,
                        kwhtrigger: data.kwhtrigger
                    };
                    devices.push(newDevice);

                    const option = new Option(newDevice.name, deviceCode);
                    deviceSelector.add(option);
                    option.selected = true;

                }

                localStorage.setItem("devices", JSON.stringify(devices));
                document.getElementById('device-form-container').style.display = 'none';
                document.getElementById('fieldsets').style.display = 'block';
                document.getElementById('device-name').value = '';
                document.getElementById('device-code').value = '';

            } catch (error) {
                alert("Device key not valid. Check you have typed the key correctly.");
            }
            updateData(deviceName);
        }

        // Close the device form without adding a device
        document.getElementById('cancel-device').addEventListener('click', function () {
            document.getElementById('device-form-container').style.display = 'none';
            document.getElementById('device-name').value = '';
            document.getElementById('device-code').value = '';
            deviceSelector.selectedIndex = 0;
            document.getElementById('fieldsets').style.display = 'block';

            document.getElementById('title').style.display = 'block';

            document.getElementById('yesterday-data').style.display = 'none';
            document.getElementById('today-data').style.display = 'none';
            document.getElementById('tomorrow-data').style.display = 'none';
        });

        //Listens to changes in the device selector and updates the data as necessary.
        deviceSelector.addEventListener("change", function () {
            // Show the form when the "add device" option is selected
            if (this.value === "add-device") {
                document.getElementById('fieldsets').style.display = 'none';
                document.getElementById('device-form-container').style.display = 'block';
                document.getElementById('yesterday-data').style.display = 'none';
                document.getElementById('today-data').style.display = 'none';
                document.getElementById('tomorrow-data').style.display = 'none';
                document.getElementById('title').style.display = 'none';
            }
            else if (this.value === "default") {
                // Hide the form when the "select device" option is selected
                document.getElementById('device-form-container').style.display = 'none';
                document.getElementById('fieldsets').style.display = 'none';
                document.getElementById('title').style.display = 'block';
                document.getElementById('yesterday-data').style.display = 'none';
                document.getElementById('today-data').style.display = 'none';
                document.getElementById('tomorrow-data').style.display = 'none';
                updateFormLanguage();
            }
            else {
                // Hide the form and fetch/update device price data to fieldsets when any other option is selected

                console.log("apikey: " + this.value);
                console.log("device name: " + this.options[this.selectedIndex].text)
                handleDeviceSubmission(this.options[this.selectedIndex].text, this.value);
                document.getElementById('device-form-container').style.display = 'none';
                document.getElementById('fieldsets').style.display = 'block';
                document.getElementById('title').style.display = 'none';
                document.getElementById('yesterday-data').style.display = 'none';
                document.getElementById('today-data').style.display = 'block';
                document.getElementById('tomorrow-data').style.display = 'none';
                updateActiveProgress("today-menu");

            }
        });

        function calculateAverage(prices) {
            const sum = prices.reduce((acc, price) => acc + price, 0);
            return prices.length > 0 ? sum / prices.length : 0;
        }

        function calculateNthCheapestPrice(prices, n) {
            const sortedPrices = [...prices].sort((a, b) => a - b);
            return sortedPrices[n - 1] || 0;
        }

        // Function to retrieve price data
        async function fetchPriceData(apiKey, countryCode) {
            try {
                // Make the API request
                const response = await fetch(`https://api.powerant.net/retrieve_file?api_key=${apiKey}&file_name=${countryCode}.json`);

                // If not a successful request, throw an error
                if (!response.ok) {
                    throw new Error('Network response was not ok');
                }

                // Parse the JSON data from the response
                return await response.json();
            } catch (error) {
                console.error('There was a problem fetching the price data:', error);
                return null;
            }
        }

        function formatDate(date) {
            const yyyy = date.getFullYear();
            const mm = String(date.getMonth() + 1).padStart(2, '0'); // January is 0!
            const dd = String(date.getDate()).padStart(2, '0');
            return `${yyyy}${mm}${dd}`;
        }

        function formatRelativeTime(timestamp) {
            // Parse the timestamp
            const year = parseInt(timestamp.substring(0, 4), 10);
            const month = parseInt(timestamp.substring(4, 6), 10) - 1; // JS months are 0-indexed
            const day = parseInt(timestamp.substring(6, 8), 10);
            const hour = timestamp.length >= 10 ? parseInt(timestamp.substring(8, 10), 10) : null;
            // Set minutes to "00" if the timestamp includes hours but no minutes
            const minute = timestamp.length === 12 ? parseInt(timestamp.substring(10, 12), 10) : (timestamp.length === 10 ? 0 : null);

            // Create date object from timestamp
            const timestampDate = new Date(year, month, day, hour ?? 0, minute ?? 0);

            // Get current date and reset hours for accurate day comparison
            const currentDate = new Date();
            const today = new Date(currentDate.getFullYear(), currentDate.getMonth(), currentDate.getDate());
            const yesterday = new Date(today);
            yesterday.setDate(yesterday.getDate() - 1);

            // Compare dates
            const timestampDay = new Date(year, month, day);
            const daysDiff = Math.round((today - timestampDay) / (1000 * 60 * 60 * 24));

            let relativeDateString;

            const selectedLanguage = getBrowserLanguage();
            const translation = translations[selectedLanguage];

            if (daysDiff === 0) {
                // Today
                relativeDateString = hour !== null ? `${translation["today-at"]}${hour.toString().padStart(2, '0')}:${minute.toString().padStart(2, '0')}` : translation["today"];
            } else if (daysDiff === 1) {
                // Yesterday
                relativeDateString = hour !== null ? `${translation["yesterday-at"]}${hour.toString().padStart(2, '0')}:${minute ? minute.toString().padStart(2, '0') : '00'}` : translation["yesterday"];
            } else {
                // More than one day ago
                relativeDateString = `${daysDiff}${translation["days-ago"]}`;
            }

            return relativeDateString;
        }

        // Function to generate the table HTML
        function generateTableHTML(prices, kwhTrigger, cheapestHours, dayAverage, onHoursAverage, timestamp) {

            const selectedLanguage = getBrowserLanguage();
            const translation = translations[selectedLanguage];

            const times = Array.from({ length: 24 }, (_, i) => `${i}-${i + 1}`);

            // Identify the Nth cheapest price
            const sortedPrices = [...prices].sort((a, b) => a - b);
            const thCheapestPrice = sortedPrices[cheapestHours - 1] || 0;

            const rows = times.map((time, index) => {
                const price = prices[index] || 0;

                let power;
                if (price < kwhTrigger || price <= thCheapestPrice) {
                    power = 'on';
                } else {
                    power = 'off';
                }

                const powerClass = power === 'on' ? 'power-on' : 'power-off';
                if (power == 'on') {
                    power = translation["on"];
                }
                else {
                    power = translation["off"];
                }

                return [time, price, power, powerClass];
            });

            // Calculate the discount percentage
            const discountPercentage = ((dayAverage - onHoursAverage) / dayAverage) * 100;

            // Add rows for average prices
            const deviceInfoHTML = `
            <div class="device-data-card">
                <div class="device-info">${translation["device-info"]}</div>
                <div class="last-price-fetch">
                    ${translation["last-price-fetch"]}: <span>${formatRelativeTime(timestamp)}</span>
                </div>
                <div class="daily-average-price">
                    ${translation["daily-average-price"]}: <span>${dayAverage.toFixed(2)}</span>
                </div>
                <div class="your-average-price">
                    ${translation["your-average-price"]}: <span>${onHoursAverage.toFixed(2)}</span>
                </div>
                <div class="your-savings">
                    ${translation["your-savings"]}: <span>${discountPercentage.toFixed(2)}%</span>
                </div>
            </div>
            `;

            const tableHTML = `
                    <table>
                        <thead>
                            <tr>
                                <th>${translation["time"]}</th>
                                <th>${translation["price"]}</th>
                                <th>${translation["power"]}</th>
                            </tr>
                        </thead>
                        <tbody>
                            ${rows.map(row => `
                            <tr>
                                <td>${row[0]}</td>
                                <td>${row[1]}</td>
                                <td class="${row[3]}">${row[2]}</td>
                            </tr>
                            `).join('')}
                        </tbody>
                    </table>
                    ${deviceInfoHTML}
                `;

            return tableHTML;
        }



        function updateData(deviceName) {
            const devices = JSON.parse(localStorage.getItem("devices") || "[]");
            const countryCode = (devices.find(dev => dev.name === deviceName) || {}).country;
            const apiKey = (devices.find(dev => dev.name === deviceName) || {}).code;
            const trigger = (devices.find(dev => dev.name === deviceName) || {}).kwhtrigger;
            const hours = (devices.find(dev => dev.name === deviceName) || {}).hoursactive;
            const timestamp = (devices.find(dev => dev.name === deviceName) || {}).timestamp;

            fetchPriceData(apiKey, countryCode).then(data => {
                if (data) {
                    // Get formatted date strings
                    const today = new Date();
                    const yesterday = new Date(today);
                    yesterday.setDate(yesterday.getDate() - 1);
                    const tomorrow = new Date(today);
                    tomorrow.setDate(tomorrow.getDate() + 1);

                    const todayStr = formatDate(today);
                    const yesterdayStr = formatDate(yesterday);
                    const tomorrowStr = formatDate(tomorrow);

                    // Filter values based on dates
                    const yesterdayData = Object.entries(data)
                        .filter(([key,]) => key.startsWith(yesterdayStr))
                        .map(([key, value]) => value)

                    const todayData = Object.entries(data)
                        .filter(([key,]) => key.startsWith(todayStr))
                        .map(([key, value]) => value)

                    const tomorrowData = Object.entries(data)
                        .filter(([key,]) => key.startsWith(tomorrowStr))
                        .map(([key, value]) => value)

                    // Inside updateData function, after fetching the data
                    const thCheapestPriceToday = calculateNthCheapestPrice(todayData, hours);
                    const onHoursDataToday = todayData.filter(price => price < trigger || price <= thCheapestPriceToday);
                    const onHoursAverageToday = calculateAverage(onHoursDataToday);

                    // Similar calculations for yesterday and tomorrow
                    const thCheapestPriceYesterday = calculateNthCheapestPrice(yesterdayData, hours);
                    const onHoursDataYesterday = yesterdayData.filter(price => price < trigger || price <= thCheapestPriceYesterday);
                    const onHoursAverageYesterday = calculateAverage(onHoursDataYesterday);

                    const thCheapestPriceTomorrow = calculateNthCheapestPrice(tomorrowData, hours);
                    const onHoursDataTomorrow = tomorrowData.filter(price => price < trigger || price <= thCheapestPriceTomorrow);
                    const onHoursAverageTomorrow = calculateAverage(onHoursDataTomorrow);


                    // Update the DOM
                    document.getElementById('title').style.display = 'none';

                    const selectedLanguage = getBrowserLanguage();
                    const translation = translations[selectedLanguage];

                    document.getElementById("yesterday-data").innerHTML = generateTableHTML(yesterdayData, trigger, hours, calculateAverage(yesterdayData), onHoursAverageYesterday, timestamp);
                    document.getElementById("today-data").innerHTML = generateTableHTML(todayData, trigger, hours, calculateAverage(todayData), onHoursAverageToday, timestamp);
                    if (12 < today.getUTCHours()) {
                        document.getElementById("tomorrow-data").innerHTML = generateTableHTML(tomorrowData, trigger, hours, calculateAverage(tomorrowData), onHoursAverageTomorrow, timestamp);
                    }
                    else {
                        document.getElementById("tomorrow-data").innerHTML = `<h3 class="fs-subtitle">${translation["come-back-later"]}</h3>`;
                    }



                }
            });
        }
    });
</script>